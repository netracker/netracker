<html>
  <head>
    <title>Netracker</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      var conn, $currentTurn, $clicks, $turn, $game;

      var syncState = function(state) {
        $currentTurn.html(state.CurrentPlayerRole);
        $clicks.html(state.RemainingClicks);
        $turn.html(state.Turn);
      };

      var bindToMessage = function ($object, message) {
        $object.click(function (e) {
          e.preventDefault();
          conn.send(message);
        });
      };

      var initConn = function (url) {
        conn = new WebSocket(url);

        conn.onopen = function(e) {
          $game.show();
        }

        conn.onclose = function(e) {
          $game.hide();
        }

        return conn;
      }

      $(function () {
        $currentTurn = $("#currentTurn");
        $clicks = $("#clicks");
        $turn = $("#turn");
        $game = $("#game");

        $game.hide();

        bindToMessage($("#click"), "click");
        bindToMessage($("#addClick"), "addclick");
        bindToMessage($("#nextTurn"), "nextturn");

        conn = initConn("ws://localhost:3000/ws")

        conn.onmessage = function(e) {
          state = JSON.parse(e.data);
          syncState(state);
        }
      });
    </script>
  </head>
  <body>
    <ul id="game">
      <li>Current Turn: <span id="currentTurn"></span></li>
      <li>Clicks: <span id="clicks"></span></li>
      <li>Turn: <span id="turn"></span></li>
      <li><a href="#" id="click">click</a></li>
      <li><a href="#" id="nextTurn">next turn</a></li>
      <li><a href="#" id="addClick">add click</a></li>
    </ul>
  </body>
</html>
